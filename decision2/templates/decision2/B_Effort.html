{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}

{% block title %}
    
{% endblock %}
{% block scripts %}
<script src="https://code.highcharts.com/highcharts.js"></script>
<script language="javascript" type="text/javascript">  


var newStuff;
var time = document.getElementById("myVar").value;
var jsonstr = document.getElementById("myVar1").value;


var chart;

logFunc = function () {
    var line = "";
    for (var i = 0; i < arguments.length; i++) {
        line += String(arguments[i]) + ", ";
    }
    line += "\n"
    console.log(line);  // errors in chrome log
    var out = document.getElementById("console-log"); // some visible div - to watch errors
    if (out !== null) {
        out.innerHTML += line
    }
};

// ajax request without jQuery
function postUpdate(uploadStuff) {
    var xhr = new XMLHttpRequest();
    var params = 'key1=val1&key2=val2&';
    xhr.onreadystatechange = function () {
        if (xhr.readyState == XMLHttpRequest.DONE) {   // XMLHttpRequest.DONE == 4
                try {
                    updateWebsite();
                } catch (error) {
                    logFunc("response json parse error", error);
                }
            setTimeout(postUpdate, 2000);

        }
    }
    xhr.open('POST', 'http://localhost:8000/static/hello.json' , true);
    xhr.send(JSON.stringify(uploadStuff));

};
setInterval(postUpdate(),2000);

function updateWebsite() {
    var tnew = +new Date;
    var tdi = tnew - time;
    var value5;
    var value25;


    dict = { 28435:0.33,52370:0.66,77652:1,101457:1.33,126065:1.66,148152:2,172543:2.33,194913:2.66,217783:3,242304:3.33,266348:3.66,289478:4,310370:4.33,333000:4.66,355783:5,379022:5.33,401697:5.66,424371:6,447046:6.33,469720:6.66}
    for (var key in dict){
        if (key > tdi) { break; }
        value5 = dict[key];
    };

    dict1 = { 22273:0.33,43545:0.66,63909:1,81909:1.33,102455:1.66,119273:2,138000:2.33,156818:2.66,175091:3,194909:3.33,213818:3.66,233455:4,251364:4.33,268636:4.66,286273:5,309091:5.33,326818:5.66,344273:6,361818:6.33,382091:6.66,402818:7,420182:7.33,437091:7.66,452909:8,456250:8.33,471197:8.66}
    for (var key in dict1){
        if (key > tdi) { break; }
        value25 = dict1[key];
    };


    
    chart=Highcharts.chart('container', {
        chart: {
            type: 'column',
            marginTop: 20
        },
        title: {
            text: ''
        },
        xAxis: {
            categories: 
                ['',
                {% if participant.vars.type == 'lowmon' %}'',{% elif participant.vars.type == 'highmon' %}'',{% endif %}
            ],
            crosshair: true
        },
        yAxis: [{
            min: 0,
            {% if participant.vars.type == 'noenvi' %}
            {% if subsession.round_number < 30 %}
            max:20,
            {% else %}
            max:20,
            {% endif %}
            tickInterval: 2,
            {% else %}
            {% if subsession.round_number < 30 %}
            max:10,
            {% else %}
            max:20,
            {% endif %}
            tickInterval: 1,
            {% endif %}
            title: {
                text: {% if participant.vars.type == 'mon' %} 'gepfl. Bäume' {% elif participant.vars.type == 'punish' %} 'gepfl. Bäume' {% else %} null {% endif %}
            }
            {% if participant.vars.type == 'force' %},
            plotLines: [{
                    value: 10,
                    color: 'black',
                    dashStyle: 'solid',
                    width: 3,
                    label: {
                        text: 'Ziel'
                    }
                }] {% endif %}
        } 
        {% if participant.vars.type == 'mon' %},{
            min: 0,
            {% if subsession.round_number <= 20 %}
            max:10,
            {% else %}
            max:30,
            {% endif %}
            tickInterval: 1,
            title: {
                text: '€'
            },
            opposite: true
        }
        {% elif participant.vars.type == 'punish' %},{
            min: 0,
            {% if subsession.round_number <= 20 %}
            max:10,
            {% else %}
            max:30,
            {% endif %}
            tickInterval: 1,
            title: {
                text: '€'
            },
            opposite: true 
        }
        {% endif %}
        ],
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0,
                animation: false
            }
        },
        series: [{
        {% if participant.vars.type == 'mon' %}
            name: 'gepfl. Bäume',
            data: [{{ tree }}/100],
            color: "#228B22"},
            {
            name: 'Bonus',
            data: [{{ wage_dis }}/100]
        {% elif participant.vars.type == 'punish' %}
            name: 'gepfl. Bäume',
            data: [{{ tree }}/100],
            color: "#228B22"}, 
            {
            name: 'Sanktion',
            data: [{{ pun_dis }}],
            color:"#a31010"
        {% elif participant.vars.type == 'nudge' %}
        name: 'gepfl. Bäume',
            data: [{{ tree }}/100],
            color: "#228B22"}, 
            {
            name: 'Durchschn.',
            data: [value5],
            color: "#76b877"},
            {
            name: 'Top 25%',
            data: [ value25 ], 
            color:"#76b877"
        {% else %}
            name: 'gepfl. Bäume',
            data: [{{ tree }}/100],
            color: "#228B22"
        {% endif %}
        }]
    });
}

        function reset(){

            document.getElementById("screen").value = '';

        }

        document.getElementById("cont").style.display="none";
        function showhide()
        {
        var div = document.getElementById("cont");
        if (div.style.display === "none") {
        div.style.display = "block";
        } else {
        div.style.display = "none";
        }
        } 


        </script>
</script>
{% endblock %}
{% block styles %}
  <style type="text/css">
#button {
    -moz-box-shadow:inset 0px 1px 0px 0px #c7cbd6;
    -webkit-box-shadow:inset 0px 1px 0px 0px #c7cbd6;
    box-shadow:inset 0px 1px 0px 0px #c7cbd6;
    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #b7bac2), color-stop(1, #7c858f));
    background:-moz-linear-gradient(top, #b7bac2 5%, #7c858f 100%);
    background:-webkit-linear-gradient(top, #b7bac2 5%, #7c858f 100%);
    background:-o-linear-gradient(top, #b7bac2 5%, #7c858f 100%);
    background:-ms-linear-gradient(top, #b7bac2 5%, #7c858f 100%);
    background:linear-gradient(to bottom, #b7bac2 5%, #7c858f 100%);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#b7bac2', endColorstr='#7c858f',GradientType=0);
    background-color:#b7bac2;
    -moz-border-radius:6px;
    -webkit-border-radius:6px;
    border-radius:6px;
    border:1px solid #7c7f87;
    display:inline-block;
    cursor:pointer;
    color:#ffffff;
    font-family:Arial;
    font-size:14px;
    padding:5px 76px;
    text-decoration:none;
    text-shadow:0px 1px 0px #1c2847;
    }
    #button:hover {
    background:-webkit-gradient(linear, left top, left bottom, color-stop(0.05, #7c858f), color-stop(1, #b7bac2));
    background:-moz-linear-gradient(top, #7c858f 5%, #b7bac2 100%);
    background:-webkit-linear-gradient(top, #7c858f 5%, #b7bac2 100%);
    background:-o-linear-gradient(top, #7c858f 5%, #b7bac2 100%);
    background:-ms-linear-gradient(top, #7c858f 5%, #b7bac2 100%);
    background:linear-gradient(to bottom, #7c858f 5%, #b7bac2 100%);
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#7c858f', endColorstr='#b7bac2',GradientType=0);
    background-color:#7c858f;
    }
    #button:active {
    position:relative;
    top:1px;
    }
.z{
        padding-top: 10px ;
        padding-bottom: 40px ;
    }
.table{
        position: fixed;
        right: 3%;
        width: 15%;
        top:60%;
        padding: 10px;
    }

.b{
        padding-top: 10px ;
        padding-bottom: 10px ;
    }
.c{
        padding-top: 10px ;
        padding-bottom: 10px ;
    }
{% if participant.vars.type == 'force' %}
.otree-timer {
        display: none;
        }
{% else %}
.otree-timer {
        position:absolute;
        top:13%;
        right:0;
        }
        {% endif %}
img.im1 {
  max-width:100%;
  max-height:100%;
}
  </style>
{% endblock %}

{% block content %}
<div class="z">
<div id='button' class="z" onclick="showhide()">Hilfe: Anleitung</div>
<div id="cont">
<p>In dieser Aufgabe ist es das Ziel eine Zahlensequenz in Buchstaben zu übersetzen. Sie sehen unten (1) eine Zahlensequenz, (2) die Schlüsseltabelle, die vorgibt, durch welche Buchstaben die Nummern repräsentiert werden, und (3) ein Textfeld, in das die Lösung eingegeben werden soll. Insofern die Aufgabe korrekt beantwortet wurde, erscheint eine neue Aufgabe. Insgesamt haben Sie fünf Minuten Zeit so viele Aufgaben wie möglich zu Lösen. Ist die Maximalanzahl an Aufgaben vor Ablauf der Zeit erreicht, wird das Spiel vorzeitig beendet.</p>
</div>
</div>
<font size="4">
<table class="table">
    
    <table border=1 class="centerTable" width = "100%">
        <tbody>
            <tr>
                <td width="(10)%" align="center" height="40px">{{ N1 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N2 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N3 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N4 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N5 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N6 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N7 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N8 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N9 }}</td>
                <td width="(10)%" align="center" height="40px">{{ N10 }}</td>
            </tr>
            <tr>
                <td width="(10)%" align="center" height="40px">{{ A }} </td>
                <td width="(10)%" align="center" height="40px">{{ B }}</td>
                <td width="(10)%" align="center" height="40px">{{ C }}</td>
                <td width="(10)%" align="center" height="40px">{{ D }}</td>
                <td width="(10)%" align="center" height="40px">{{ E }}</td>
                <td width="(10)%" align="center" height="40px">{{ F }}</td>
                <td width="(10)%" align="center" height="40px">{{ G }}</td>
                <td width="(10)%" align="center" height="40px">{{ H }}</td>
                <td width="(10)%" align="center" height="40px">{{ I }}</td>
                <td width="(10)%" align="center" height="40px">{{ J }}</td>
            </tr>
        </tbody>
    </table>
<p>&nbsp;</p>
</table>
</font>

<div class="c"> 
<font size="4">  
    <table border=0 class="centerTable" width = "100%">
        <tbody>
            <tr>
            {% if participant.vars.type == 'nudge' %}
                <td width="45%" align="center" height="70px"><p size="4"><strong>Code: {{question}}</strong></p></td>

                <td width="10%" style="vertical-align: bottom; text-align: center" rowspan=2 height="70px">
                {% if subsession.round_number == 1 %}
                {% else %}
                {% if face == 1 %}
                <img class=im1 src="{% static "pebs/happy.png" %}" "/>
                {% elif face == 2 %}
                <img class=im1 src="{% static "pebs/neutral.png" %}" "/>
                {% else %}
                <img class=im1 src="{% static "pebs/frowny.png" %}" "/>
                {% endif %}
                {% endif %}
                <br>
                <br>
                <br>
                <br>
                </td>
                <td width="45%" align="center" height="70px" rowspan=2><script src="https://code.highcharts.com/highcharts.js"></script>
                                                                    <script src="https://code.highcharts.com/modules/exporting.js"></script>
                                                                    <script src="https://code.highcharts.com/modules/export-data.js"></script>

                                                                <div id="container" style="min-width: 100px; height: 400px; margin: 0 auto"></div> </td>
            </tr>
            {% else %}
            <td width="50%" align="center" height="70px"><p><strong>Code: {{question}}</strong></p></td>
                <td width="50%" align="center" height="70px" rowspan=2><script src="https://code.highcharts.com/highcharts.js"></script>
                                                                    <script src="https://code.highcharts.com/modules/exporting.js"></script>
                                                                    <script src="https://code.highcharts.com/modules/export-data.js"></script>

                                                                <div id="container" style="min-width: 100px; height: 400px; margin: 0 auto"></div> </td>
            </tr>
            {% endif %}
            </font>
    
            <tr>
            <td width="50%" align="center" height="70px"><p> <strong>Bitte antwort hier eingeben:</strong></p><input type="text" name="answer" autofocus="autofocus" id=1  required/> {{ form.answer.errors }}</td>
            </tr>
        </tbody>
    </table>
</div>

<table border=0 class="centerTable" width = "100%">
        <tbody>
            <tr>
                <td width="20%" align="left" height="70px"><button class="answer btn btn-success"  >Antworten</button></td>
           
                <td width="80%" align="right" style="vertical-align: top;" height="70px">{% if participant.vars.type == "punish" %}{% if participant.vars.punleft > 0 %}<strong>Sie müssen noch {{ participant.vars.punleft}} Aufgaben lösen um die Sanktion zu umgehen.</strong>{% else %}<strong>Sanktion vermieden!{% endif %}{% endif %}</td>
             </tr>
        </tbody>
    </table>


<input type="hidden" id="myVar" name="variable" value="{{ tita }}">
<input type="hidden" id="myVar1" name="variable" value="{ 'key1': 20, 'key2': 60 }">
        
    

{% endblock %}
